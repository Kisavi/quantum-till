<section class="flex">
<section class="grow lg:px-3">
  @let stock = stock$ | async;

  @if (stock) {
    @if (stock.length) {
      <div class="flex flex-col lg:grid lg:grid-cols-2 gap-4">
        @for (item of stock; track item.product.id) {
          <app-sale-item [stockItem]="item" />
        }
      </div>
    } @else {
      <div class="text-center py-20">
        <div class="flex flex-col items-center gap-4 text-gray-500">
          <i class="pi pi-box text-8xl opacity-30"></i>
          <div class="text-center">
            <p class="text-lg font-medium mb-2">No products in stock</p>
            @if (tripId) {
              <p class="text-sm">This trip has no allocated stock</p>
            } @else {
              <p class="text-sm">Add stock to warehouse to begin selling</p>
            }
          </div>
        </div>
      </div>
    }
  } @else {
    <div class="text-center py-20">
      <div class="flex flex-col items-center gap-4">
        <i class="pi pi-spin pi-spinner text-4xl text-blue-500"></i>
        <p class="text-lg text-gray-600">Loading products...</p>
      </div>
    </div>
  }
</section>

  <div
    class="sticky top-15 min-w-3/10 bg-white shadow rounded-lg h-[calc(100vh-180px)] hidden lg:block"
  >
    <app-cart [tripId]="tripId" />
  </div>
</section>

<p-drawer
  header="Bottom Drawer"
  [(visible)]="mobileCartVisible"
  position="bottom"
  [fullScreen]="true"
>
  <app-cart [tripId]="tripId" />
</p-drawer>

<span class="lg:hidden fixed bottom-18 right-4 z-50">
  <button pButton severity="primary" (click)="revealMobileCart()" icon="pi pi-shopping-cart">
    {{ cart().length }}
  </button>
</span>
